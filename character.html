<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="playerInfo.js"></script>
    <script src="itemLists.js"></script>
    <style>
        .number {
            text-align: end;
            background-color: antiquewhite;
        }
        th {
            background-color: aquamarine;
            color: crimson;
        }
        button {
            background-color: red;
            color: antiquewhite;
        }

    </style>
</head>
<body>
    
    <script>
        //Player stats tracking
        let playerMaxHealth = 4;
        let playerCurrentHealth = 4;

        let blackenedBloodVailMaxCharges = 1;
        let blackenedBloodVailCurrentCharges = 1;

        let inventoryList = [];

        displayView();
        function displayView(){
            let statHTML = '';
            let currencyHTML = '';
            let inventoryHTML = '';
            let indexStats = 0;
            let indexCurrency = 0;
            
            for(let stat of stats){
                statHTML += createStatTableHTML(stat, indexStats);
                indexStats++;
            }

            for(let type of currency){
                currencyHTML += createCurrencyTableHTML(type, indexCurrency);
                indexCurrency++;
            }

            for(let index = 0; index < inventoryList.length; index++){
                console.log(index)
                inventoryHTML += createInventoryItem(index);
            }

            document.body.innerHTML = /*HTML*/ `
                <div>
                    Player HP: ${playerMaxHealth}
                    <br />
                    <br />
                    <button onclick="restAtCamp()">Go to camp</button>
                    <br />
                    Blackened Blood Vial Charges: ${blackenedBloodVailCurrentCharges}
                    <br />
                    <button onclick="useVialForHP()">Drink for HP</button>
                    <button onclick="useVialForReroll()">Drink for Reroll</button>
                    <button onclick="blackenedBloodVailMaxCharges++">Add charge</button>
                    <br />
                    <table>
                        ${currencyHTML}
                        <tr>
                            <th>Player Stats</th>
                            <td>Max level</td>
                            <td class="number">4</td>
                            <td>Level cost</td>
                        </tr>
                        ${statHTML}
                    </table>
                    <br />
                    <button onclick="rollWeapon(0)">Roll for starter weapon</button>
                    <br />
                    <br />
                    <button onclick="rollWeapon(1)">Roll for act 1 weapon</button>
                    <br />
                    <br />
                    <button onclick="rollWeapon(2)">Roll for act 2 weapon</button>
                    <br />
                    <br />
                    <button onclick="rollWeapon(3)">Roll for act 3 weapon</button>
                    <br />
                    <table>
                        ${inventoryHTML}
                    </table>
            `;
        }

        function createCurrencyTableHTML(type, i){
            return /*HTML*/ `
                <tr>
                    <th>${type.displayName}</th>
                    <td class="number">${type.amount}</td>
                    <td><button onclick="addCurrency(${i})">+</button></td>
                </tr>
            `;
        }

        function createStatTableHTML(stat, i){
            if(stat.cost > currency[0].amount || stat.cost == ''){
                return /*HTML*/ `
                <tr>
                    <th>${stat.displayName}</th>
                    <td class="number">${stat.level}</td>
                    <td></td>
                    <td class="number">${stat.cost}</td>
                </tr>
            `;  
            }
            return /*HTML*/ `
                <tr>
                    <th>${stat.displayName}</th>
                    <td class="number">${stat.level}</td>
                    <td><button onclick="levelStat(${i})">+</button></td>
                    <td class="number">${stat.cost}</td>
                </tr>
            `;
        }

        function createInventoryItem(index){
            item = inventoryList[index];
            console.log(item)
            return /*HTML*/ `
                <tr>
                    <th>Item name:</th>
                    <td>${item.weaponName}</td>
                </tr>
                <tr>
                    <th>Requirements:</th>
                    <td>${item.requirementValue} ${item.requirementStat}</td>
                </tr>
                <tr>
                    <th>
                        Equipped 
                        Benefits:
                    </th>
                    <td>${item.eqiuppedBenefits}</td>
                </tr>
                <tr>
                    <th>Damage:</th>
                    <td>${item.damage}</td>
                </tr>
            `
        }

        function rollWeapon(index){
            let randomIndex = Math.floor(Math.random() * weaponsList[index].length);
            let weaponObj = weaponsList[index].splice(randomIndex, 1);
            weaponObj = weaponObj.pop()
            inventoryList.push(weaponObj);
            displayView();
        }


        function useVialForHP(){
            if(blackenedBloodVailCurrentCharges >= 1){
                playerCurrentHealth += 4;
                blackenedBloodVailCurrentCharges--;
                if(playerCurrentHealth > playerMaxHealth){
                    playerCurrentHealth = playerMaxHealth;
                }
                displayView();
            }
            else {return}
        }

        function useVialForReroll(){
            if(blackenedBloodVailCurrentCharges >= 1){
                blackenedBloodVailCurrentCharges--;
                displayView();
            }
            else {return}
        }

        function restAtCamp(){
            blackenedBloodVailCurrentCharges = blackenedBloodVailMaxCharges;
            displayView();
        }

        function levelStat(index){
            let stat = stats[index];
            let boneFragments = currency[0]
            const levelCostList = [4, 8, 12, 16, ''];

            if(stat.level == 4){return}
            else if(boneFragments.amount >= stat.cost){
                stat.level++;
                boneFragments.amount -= stat.cost;
                stat.cost = levelCostList[stat.level];
            }

            displayView();
        }

        function addCurrency(index){
            let type = currency[index];

            type.amount++;
            displayView();
        }
    </script>
</body>
</html>